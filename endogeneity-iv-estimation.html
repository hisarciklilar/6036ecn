<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>14&nbsp; Endogeneity and Instrumental Variable Estimation – R-workshops</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./iv-estimation-institutions-and-growth.html" rel="next">
<link href="./panel-data-misspecification.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./endogeneity-iv-estimation.html">Seminar 9 (18 March 2025)</a></li><li class="breadcrumb-item"><a href="./endogeneity-iv-estimation.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Endogeneity and Instrumental Variable Estimation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R-workshops</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 1 (21 January 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics-of-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basics of R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 2 (28 January 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-management-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Management in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./importing-data-into-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Importing Data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-regression-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Regression Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 3 (4 February 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple-regression-and-diagnostic-checks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple Regression and Diagnostic Checks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 4 (11 February 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-time-series-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to Time Series Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 5 (18 February 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./non-stationarity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Unit Root (Non-stationary Time Series): Augmented Dickerm(y-Fuller Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cointegration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Cointegration: Engle-Granger Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 6 (25 February 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualisation-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualisation Using <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-panel-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introduction to Panel Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 7 and 8 (4 and 11 March 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel-data-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Panel Data Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel-data-misspecification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Panel Data Misspecification Tests</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 9 (18 March 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./endogeneity-iv-estimation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Endogeneity and Instrumental Variable Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Seminar 10 (25 March 2025)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv-estimation-institutions-and-growth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">IV Estimation: The Role of Institutions in Economic Growth</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#case-i-2sls-with-one-endogenous-one-exogenous-variable" id="toc-case-i-2sls-with-one-endogenous-one-exogenous-variable" class="nav-link active" data-scroll-target="#case-i-2sls-with-one-endogenous-one-exogenous-variable"><span class="header-section-number">14.1</span> Case I: 2SLS with one endogenous, one exogenous variable</a>
  <ul class="collapse">
  <li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1"><span class="header-section-number">14.1.1</span> Task 1</a></li>
  <li><a href="#task-2" id="toc-task-2" class="nav-link" data-scroll-target="#task-2"><span class="header-section-number">14.1.2</span> Task 2</a></li>
  <li><a href="#task-3" id="toc-task-3" class="nav-link" data-scroll-target="#task-3"><span class="header-section-number">14.1.3</span> Task 3</a></li>
  <li><a href="#task-4" id="toc-task-4" class="nav-link" data-scroll-target="#task-4"><span class="header-section-number">14.1.4</span> Task 4</a></li>
  <li><a href="#task-5" id="toc-task-5" class="nav-link" data-scroll-target="#task-5"><span class="header-section-number">14.1.5</span> Task 5</a></li>
  <li><a href="#task-6" id="toc-task-6" class="nav-link" data-scroll-target="#task-6"><span class="header-section-number">14.1.6</span> Task 6</a></li>
  </ul></li>
  <li><a href="#case-ii-2sls-with-one-endogenous-and-multiple-exogenous-variables" id="toc-case-ii-2sls-with-one-endogenous-and-multiple-exogenous-variables" class="nav-link" data-scroll-target="#case-ii-2sls-with-one-endogenous-and-multiple-exogenous-variables"><span class="header-section-number">14.2</span> Case II: 2SLS with one endogenous and multiple exogenous variables</a>
  <ul class="collapse">
  <li><a href="#task-7" id="toc-task-7" class="nav-link" data-scroll-target="#task-7"><span class="header-section-number">14.2.1</span> Task 7</a></li>
  <li><a href="#task-8" id="toc-task-8" class="nav-link" data-scroll-target="#task-8"><span class="header-section-number">14.2.2</span> Task 8</a></li>
  <li><a href="#task-9" id="toc-task-9" class="nav-link" data-scroll-target="#task-9"><span class="header-section-number">14.2.3</span> Task 9</a></li>
  <li><a href="#task-10" id="toc-task-10" class="nav-link" data-scroll-target="#task-10"><span class="header-section-number">14.2.4</span> Task 10</a></li>
  <li><a href="#task-11" id="toc-task-11" class="nav-link" data-scroll-target="#task-11"><span class="header-section-number">14.2.5</span> Task 11</a></li>
  <li><a href="#guidance-5" id="toc-guidance-5" class="nav-link" data-scroll-target="#guidance-5"><span class="header-section-number">14.2.6</span> Guidance</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">14.3</span> Further Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./endogeneity-iv-estimation.html">Seminar 9 (18 March 2025)</a></li><li class="breadcrumb-item"><a href="./endogeneity-iv-estimation.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Endogeneity and Instrumental Variable Estimation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Endogeneity and Instrumental Variable Estimation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this section we will be using <code>mroz</code> data, obtained from Wooldridge’s Econometric Analysis of Cross Section and Panel Data book’s <a href="https://www.stata.com/texts/eacsap/">official site for downloadable materials</a>. This is a “PSID data on the wages of 428 working, married women”.</p>
<p>We start by installing the required packages and loading the required libraries. Note that you do not need to install an already installed package if you are using your private computer. But you will have to do this every time you require the package if you are on a university gadget.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyverse")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("haven")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(ivreg)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("sandwich")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("lmtest")</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># to import data, which is in Stata format</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ivreg) <span class="co"># IV estimation</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich) <span class="co"># for robust se calculations</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest) <span class="co"># for coeftest</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo

Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer) <span class="co"># create formatted tables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Please cite as: 

 Hlavac, Marek (2022). stargazer: Well-Formatted Regression and Summary Statistics Tables.
 R package version 5.2.3. https://CRAN.R-project.org/package=stargazer </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(Hmisc) # add labels to variables</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(ggplot2)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#library(dplyr) # for data manipulation</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#library(plm) # to estimate linear panel data models</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#library(fastDummies) # create dummies based on categorical (factor) variable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the <code>mroz_v2.dta</code> data. <code>mroz_v2</code> data is provided to you in Stata format. Stata is an other statistical package, widely used for data analysis and econometric modelling. You will see that even when Stata is not installed in your system, you will be able to import it into R using the <code>haven</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mroz <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"assets/data/mroz_v2.dta"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#View(mroz)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See the the fist few rows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mroz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
  hours kidslt6 kidsge6   age  educ  wage repwage hushrs husage huseduc huswage
  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1  1610       1       0    32    12  3.35    2.65   2708     34      12    4.03
2  1656       0       2    30    12  1.39    2.65   2310     30       9    8.44
3  1980       1       3    35    12  4.55    4.04   3072     40      12    3.58
4   456       0       3    34    12  1.10    3.25   1920     53      10    3.54
5  1568       1       2    31    14  4.59    3.60   2000     32      12   10   
6  2032       0       0    54    12  4.74    4.70   1040     57      11    6.71
# ℹ 8 more variables: faminc &lt;dbl&gt;, motheduc &lt;dbl&gt;, fatheduc &lt;dbl&gt;, unem &lt;dbl&gt;,
#   city &lt;dbl&gt;, exper &lt;dbl&gt;, lwage &lt;dbl&gt;, expersq &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Instrumental variable approach is widely referred to as Two-stage Least Squares. These two will be used interchangeably. Please also note the abbreviations IV and 2SLS, respectively, for the former and the latter.</p>
<section id="case-i-2sls-with-one-endogenous-one-exogenous-variable" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="case-i-2sls-with-one-endogenous-one-exogenous-variable"><span class="header-section-number">14.1</span> Case I: 2SLS with one endogenous, one exogenous variable</h2>
<section id="task-1" class="level3" data-number="14.1.1">
<h3 data-number="14.1.1" class="anchored" data-anchor-id="task-1"><span class="header-section-number">14.1.1</span> Task 1</h3>
<p>Estimate a regression of logarithmic wage <code>lwage</code> using education (<code>educ</code>) and experience (<code>exper</code>) as independent variables. Include experience in quadratic form.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> expersq, <span class="at">data =</span> mroz)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lwage ~ educ + exper + expersq, data = mroz)

Residuals:
     Min       1Q   Median       3Q      Max 
-3.08404 -0.30627  0.04952  0.37498  2.37115 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.5220407  0.1986321  -2.628  0.00890 ** 
educ         0.1074896  0.0141465   7.598 1.94e-13 ***
exper        0.0415665  0.0131752   3.155  0.00172 ** 
expersq     -0.0008112  0.0003932  -2.063  0.03974 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6664 on 424 degrees of freedom
Multiple R-squared:  0.1568,    Adjusted R-squared:  0.1509 
F-statistic: 26.29 on 3 and 424 DF,  p-value: 1.302e-15</code></pre>
</div>
</div>
<p>Because it is highly likely that we will observe heteroscedasticity, let us summarise the results with heteroscedasticity-robust standard errors. For this, we will use <code>coeftest</code>, which comes with the <code>lmtest</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ols, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate  Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.52204068  0.20165046 -2.5888 0.009961 ** 
educ         0.10748965  0.01321897  8.1315 4.72e-15 ***
exper        0.04156651  0.01527304  2.7216 0.006765 ** 
expersq     -0.00081119  0.00042007 -1.9311 0.054139 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Have a look at the coefficient estimates, standard errors, t-statistics and the p-values reported with and without the heteroscedasticity-robust standard errors. How do they compare?</p>
<div style="color:green">
<p>Calculation of robust standard errors corrects for the bias in standard error estimates due to heteroscedasticity or autocorrelation (heteroscedasticity in the case of this example). Therefore, the coefficient estimates remain the same while standard errors are adjusted for the bias. Because of this change in the standard errors, the t-statistics and the p-values (which use standard error in calculations) also change.</p>
</div>
</section>
<section id="task-2" class="level3" data-number="14.1.2">
<h3 data-number="14.1.2" class="anchored" data-anchor-id="task-2"><span class="header-section-number">14.1.2</span> Task 2</h3>
<p>Explain why there may be an endogeneity issue in the model we estimated above.</p>
<div style="color:green">
<p>Ability is an important determinant of wages, which is not included in the given regression. It is also expected to be highly correlated with education. If that’s the case, omission of ability from the model will lead to a correlation between education and the error term. This causes an issue of endogeneity.</p>
</div>
</section>
<section id="task-3" class="level3" data-number="14.1.3">
<h3 data-number="14.1.3" class="anchored" data-anchor-id="task-3"><span class="header-section-number">14.1.3</span> Task 3</h3>
<p>Identify the potential instruments that you may use in the data you are given and explain your choice.</p>
<div style="color:green">
<p>The three potential instruments provided in data are: mother’s education, father’s education and husband’s education. Each of these three variables are likely to be highly correlated with individual’s education but not with their wage.</p>
</div>
</section>
<section id="task-4" class="level3" data-number="14.1.4">
<h3 data-number="14.1.4" class="anchored" data-anchor-id="task-4"><span class="header-section-number">14.1.4</span> Task 4</h3>
<p>Estimate the above equation by two-stage least squares (i.e.&nbsp;instrumental variable estimation) manually.</p>
<section id="guidance" class="level4" data-number="14.1.4.1">
<h4 data-number="14.1.4.1" class="anchored" data-anchor-id="guidance"><span class="header-section-number">14.1.4.1</span> Guidance</h4>
<p><strong>Step 1</strong></p>
<p>Let’s say we want to use husband’s education <code>huseduc</code> as an instrument for the woman’s education.</p>
<p>Regress the endogenous variable on the instrument and all other exogenous variables of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>stage1_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(educ <span class="sc">~</span> huseduc <span class="sc">+</span> exper <span class="sc">+</span> expersq, <span class="at">data =</span> mroz)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage1_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = educ ~ huseduc + exper + expersq, data = mroz)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.5093 -0.9785 -0.2310  1.2857  6.3994 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  6.694524   0.454849  14.718   &lt;2e-16 ***
huseduc      0.448194   0.029495  15.195   &lt;2e-16 ***
exper        0.042220   0.036338   1.162    0.246    
expersq     -0.001017   0.001085  -0.937    0.349    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.841 on 424 degrees of freedom
Multiple R-squared:  0.3558,    Adjusted R-squared:  0.3512 
F-statistic: 78.05 on 3 and 424 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Obtain predictions of education using the above model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mroz<span class="sc">$</span>educ_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(stage1_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2</strong></p>
<p>Estimate the wage regression, replacing the endogenous <code>educ</code> variable, with its exogenous version <code>educ_hat</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>stage2_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> educ_hat <span class="sc">+</span> exper <span class="sc">+</span> expersq, <span class="at">data =</span> mroz)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage2_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lwage ~ educ_hat + exper + expersq, data = mroz)

Residuals:
     Min       1Q   Median       3Q      Max 
-3.12116 -0.34011  0.05149  0.38784  2.36570 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.2980989  0.3248571  -0.918 0.359334    
educ_hat     0.0893851  0.0250210   3.572 0.000394 ***
exper        0.0425893  0.0138836   3.068 0.002296 ** 
expersq     -0.0008457  0.0004148  -2.039 0.042080 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6999 on 424 degrees of freedom
Multiple R-squared:   0.07, Adjusted R-squared:  0.06342 
F-statistic: 10.64 on 3 and 424 DF,  p-value: 9.339e-07</code></pre>
</div>
</div>
<p>Let us report these results using the heteroscedasticity-robust standard errors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(stage2_1, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate  Std. Error t value  Pr(&gt;|t|)    
(Intercept) -0.29809893  0.33474934 -0.8905 0.3736950    
educ_hat     0.08938509  0.02448649  3.6504 0.0002945 ***
exper        0.04258927  0.01591354  2.6763 0.0077327 ** 
expersq     -0.00084567  0.00044034 -1.9205 0.0554634 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="task-5" class="level3" data-number="14.1.5">
<h3 data-number="14.1.5" class="anchored" data-anchor-id="task-5"><span class="header-section-number">14.1.5</span> Task 5</h3>
<p>Estimate the above equation by 2SLS (IV estimation) using R’s built-in command <code>ivreg</code>. Compare the coefficients and standard errors with what you obtained manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>iv_1 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(lwage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> expersq <span class="sc">|</span> huseduc <span class="sc">+</span> exper <span class="sc">+</span> expersq, <span class="at">data =</span> mroz)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iv_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = lwage ~ educ + exper + expersq | huseduc + exper + 
    expersq, data = mroz)

Residuals:
     Min       1Q   Median       3Q      Max 
-3.07677 -0.32148  0.03525  0.37605  2.36256 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.2980989  0.3099189  -0.962 0.336668    
educ         0.0893851  0.0238705   3.745 0.000206 ***
exper        0.0425893  0.0132451   3.215 0.001402 ** 
expersq     -0.0008457  0.0003957  -2.137 0.033155 *  

Diagnostic tests:
                 df1 df2 statistic p-value    
Weak instruments   1 424   230.900  &lt;2e-16 ***
Wu-Hausman         1 423     0.892   0.346    
Sargan             0  NA        NA      NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6677 on 424 degrees of freedom
Multiple R-Squared: 0.1536, Adjusted R-squared: 0.1476 
Wald test: 11.69 on 3 and 424 DF,  p-value: 2.26e-07 </code></pre>
</div>
</div>
<div style="color:green">
<p>The coefficients reported by the <code>ivreg</code> are the same as our manual two-stage estimation. The standard errors are slightly different. This is because in the manual calculations, during the estimation of the second stage, we use predictions from the first stage (<code>educ_hat</code>). This introduces additional uncertainty into the model. Although the statistical packages (such as R) follow a similar approach, they correct for the bias in standard error calculations before reporting these numbers.</p>
</div>
<p>Note that this is a different adjustment than calculation of heteroscedasticity-robust standard errors. So let’s integrate that too</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(iv_1, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate  Std. Error t value  Pr(&gt;|t|)    
(Intercept) -0.29809893  0.31885872 -0.9349 0.3503753    
educ         0.08938509  0.02306960  3.8746 0.0001237 ***
exper        0.04258927  0.01525285  2.7922 0.0054716 ** 
expersq     -0.00084567  0.00041999 -2.0135 0.0446901 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="task-6" class="level3" data-number="14.1.6">
<h3 data-number="14.1.6" class="anchored" data-anchor-id="task-6"><span class="header-section-number">14.1.6</span> Task 6</h3>
<p>Compare the coefficient on education in OLS and 2SLS approaches.</p>
<section id="guidance-1" class="level4" data-number="14.1.6.1">
<h4 data-number="14.1.6.1" class="anchored" data-anchor-id="guidance-1"><span class="header-section-number">14.1.6.1</span> Guidance</h4>
<p>We can compare the three models summarising their results in one table using <code>stargazer</code> package. Please note that the table below does not provide heteroscedasticity corrected standard errors. We can replace these conventional standard errors reported using a matrix of robust ones but this requires a few more steps that is beyond this module. You may change these manually for the moment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(ols, stage2_1, iv_1, <span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===============================================================
                                     Dependent variable:       
                               --------------------------------
                                            lwage              
                                       OLS         instrumental
                                                     variable  
                                  (1)       (2)        (3)     
---------------------------------------------------------------
educ                           0.107***              0.089***  
                                (0.014)              (0.024)   
                                                               
educ_hat                                 0.089***              
                                          (0.025)              
                                                               
exper                          0.042***  0.043***    0.043***  
                                (0.013)   (0.014)    (0.013)   
                                                               
expersq                        -0.001**  -0.001**    -0.001**  
                               (0.0004)  (0.0004)    (0.0004)  
                                                               
Constant                       -0.522***  -0.298      -0.298   
                                (0.199)   (0.325)    (0.310)   
                                                               
---------------------------------------------------------------
Observations                      428       428        428     
R2                               0.157     0.070      0.154    
Adjusted R2                      0.151     0.063      0.148    
Residual Std. Error (df = 424)   0.666     0.700      0.668    
F Statistic (df = 3; 424)      26.286*** 10.638***             
===============================================================
Note:                               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<div style="color:green">
<p>As expected, the coefficient on education is higher in OLS estimation than the coefficient obtained through 2SLS. This is because education captures not only the genuine impact of years of schooling but also ability. Each of these indicators are expected to have a positive impact on wages, and they are positively correlated with each other. Hence, omission of ability from the wage regression creates a positive bias on the education’s coefficient.</p>
</div>
</section>
</section>
</section>
<section id="case-ii-2sls-with-one-endogenous-and-multiple-exogenous-variables" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="case-ii-2sls-with-one-endogenous-and-multiple-exogenous-variables"><span class="header-section-number">14.2</span> Case II: 2SLS with one endogenous and multiple exogenous variables</h2>
<section id="task-7" class="level3" data-number="14.2.1">
<h3 data-number="14.2.1" class="anchored" data-anchor-id="task-7"><span class="header-section-number">14.2.1</span> Task 7</h3>
<p>Replicate the 2SLS estimation manually (using OLS), this time with 3 instruments for education: husband’s education (<code>huseduc</code>), mother’s education (<code>motheduc</code>) and father’s education (<code>fatheduc</code>).</p>
<section id="guidance-2" class="level4" data-number="14.2.1.1">
<h4 data-number="14.2.1.1" class="anchored" data-anchor-id="guidance-2"><span class="header-section-number">14.2.1.1</span> Guidance</h4>
<p><strong>Step1</strong></p>
<p>First, estimate the first stage regression: regress the endogenous variable on the instrument and all other exogenous variables of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>stage1_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(educ <span class="sc">~</span> huseduc <span class="sc">+</span> motheduc <span class="sc">+</span> fatheduc <span class="sc">+</span> exper <span class="sc">+</span> expersq, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mroz)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage1_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = educ ~ huseduc + motheduc + fatheduc + exper + expersq, 
    data = mroz)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.6882 -1.1519  0.0097  1.0640  5.7302 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  5.5383110  0.4597824  12.046  &lt; 2e-16 ***
huseduc      0.3752548  0.0296347  12.663  &lt; 2e-16 ***
motheduc     0.1141532  0.0307835   3.708 0.000237 ***
fatheduc     0.1060801  0.0295153   3.594 0.000364 ***
exper        0.0374977  0.0343102   1.093 0.275059    
expersq     -0.0006002  0.0010261  -0.585 0.558899    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.738 on 422 degrees of freedom
Multiple R-squared:  0.4286,    Adjusted R-squared:  0.4218 
F-statistic:  63.3 on 5 and 422 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Obtain predictions of education using the above model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mroz<span class="sc">$</span>educ_hat_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(stage1_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2</strong></p>
<p>Estimate the wage regression, replacing the endogenous <code>educ</code> variable, with its exogenous version <code>educ_hat_2</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>stage2_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> educ_hat_2 <span class="sc">+</span> exper <span class="sc">+</span> expersq, <span class="at">data =</span> mroz)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage2_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lwage ~ educ_hat_2 + exper + expersq, data = mroz)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.1407 -0.3382  0.0594  0.3798  2.3860 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.1868574  0.2985449  -0.626 0.531722    
educ_hat_2   0.0803918  0.0227772   3.529 0.000462 ***
exper        0.0430973  0.0138760   3.106 0.002024 ** 
expersq     -0.0008628  0.0004144  -2.082 0.037957 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7001 on 424 degrees of freedom
Multiple R-squared:  0.06935,   Adjusted R-squared:  0.06277 
F-statistic: 10.53 on 3 and 424 DF,  p-value: 1.078e-06</code></pre>
</div>
</div>
<p>Let us report these results using the heteroscedasticity-robust standard errors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(stage2_2, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate  Std. Error t value  Pr(&gt;|t|)    
(Intercept) -0.18685736  0.31671471 -0.5900 0.5555141    
educ_hat_2   0.08039177  0.02303514  3.4900 0.0005337 ***
exper        0.04309732  0.01606065  2.6834 0.0075728 ** 
expersq     -0.00086280  0.00044548 -1.9368 0.0534340 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="task-8" class="level3" data-number="14.2.2">
<h3 data-number="14.2.2" class="anchored" data-anchor-id="task-8"><span class="header-section-number">14.2.2</span> Task 8</h3>
<p>Estimate the above equation by 2SLS (IV estimation) using R’s built-in command <code>ivreg</code>. Compare the coefficients and standard errors with what you obtained manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>iv_2 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(lwage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> expersq <span class="sc">|</span> huseduc <span class="sc">+</span> motheduc <span class="sc">+</span> fatheduc <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                exper <span class="sc">+</span> expersq, <span class="at">data =</span> mroz)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iv_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = lwage ~ educ + exper + expersq | huseduc + motheduc + 
    fatheduc + exper + expersq, data = mroz)

Residuals:
     Min       1Q   Median       3Q      Max 
-3.08378 -0.32135  0.03538  0.36934  2.35829 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.1868574  0.2853959  -0.655 0.512996    
educ         0.0803918  0.0217740   3.692 0.000251 ***
exper        0.0430973  0.0132649   3.249 0.001250 ** 
expersq     -0.0008628  0.0003962  -2.178 0.029976 *  

Diagnostic tests:
                 df1 df2 statistic p-value    
Weak instruments   3 422   104.294  &lt;2e-16 ***
Wu-Hausman         1 423     2.732  0.0991 .  
Sargan             2  NA     1.115  0.5726    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6693 on 424 degrees of freedom
Multiple R-Squared: 0.1495, Adjusted R-squared: 0.1435 
Wald test: 11.52 on 3 and 424 DF,  p-value: 2.817e-07 </code></pre>
</div>
</div>
<p>Let us also integrate heteroscedasticity-robust standard errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(iv_2, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate  Std. Error t value  Pr(&gt;|t|)    
(Intercept) -0.18685736  0.30126251 -0.6202 0.5354280    
educ         0.08039177  0.02170330  3.7041 0.0002402 ***
exper        0.04309732  0.01530642  2.8156 0.0050951 ** 
expersq     -0.00086280  0.00042166 -2.0462 0.0413549 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="task-9" class="level3" data-number="14.2.3">
<h3 data-number="14.2.3" class="anchored" data-anchor-id="task-9"><span class="header-section-number">14.2.3</span> Task 9</h3>
<p>Test for the relevance of the chosen instruments.</p>
<section id="guidance-3" class="level4" data-number="14.2.3.1">
<h4 data-number="14.2.3.1" class="anchored" data-anchor-id="guidance-3"><span class="header-section-number">14.2.3.1</span> Guidance</h4>
<div style="color: green">
<p>The chosen instruments should sufficiently explain the variation in the endogenous variable (i.e.&nbsp;the education level). The F-statistic obtained in the first stage is 63.3, which is greater than the widely accepted threshold of 10. Hence, we conclude that all the instrument set sufficiently explain the variations in education (at least one of the them has an impact that is different than zero). The instruments in this example are are relevant.</p>
</div>
</section>
</section>
<section id="task-10" class="level3" data-number="14.2.4">
<h3 data-number="14.2.4" class="anchored" data-anchor-id="task-10"><span class="header-section-number">14.2.4</span> Task 10</h3>
<p>Test for the overidentifying restrictions in the above estimation. Explain what this test does.</p>
<section id="guidance-4" class="level4" data-number="14.2.4.1">
<h4 data-number="14.2.4.1" class="anchored" data-anchor-id="guidance-4"><span class="header-section-number">14.2.4.1</span> Guidance</h4>
<div style="color: green">
<p>Instruments used in IV estimation should not normally belong to the main model of interest (i.e.&nbsp;in the case of this example, should not be a determinant of individual’s wage) and they should satisfy the relevance and exogeneity assumptions. We confirmed above that the instrument set is relevant. We can check for the exogeneity assumption by applying Sarjan’s <em>J</em> test of overidentifying restrictions.</p>
</div>
<p>First, we save the residuals from the iv estimation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mroz<span class="sc">$</span>resid_iv_2 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(iv_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then regress these saved residuals on all avilable exogenous variables (the instruments + the exogenous variables of the wage model)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>overid_test <span class="ot">&lt;-</span> <span class="fu">lm</span>(resid_iv_2 <span class="sc">~</span> huseduc <span class="sc">+</span> motheduc <span class="sc">+</span> fatheduc <span class="sc">+</span> exper <span class="sc">+</span> expersq</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                  , <span class="at">data =</span> mroz)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(overid_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = resid_iv_2 ~ huseduc + motheduc + fatheduc + exper + 
    expersq, data = mroz)

Residuals:
     Min       1Q   Median       3Q      Max 
-3.07503 -0.32777  0.04156  0.37759  2.33621 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  8.606e-03  1.773e-01   0.049    0.961
huseduc      6.781e-03  1.143e-02   0.593    0.553
motheduc    -1.039e-02  1.187e-02  -0.875    0.382
fatheduc     6.734e-04  1.138e-02   0.059    0.953
exper        5.603e-05  1.323e-02   0.004    0.997
expersq     -8.882e-06  3.956e-04  -0.022    0.982

Residual standard error: 0.67 on 422 degrees of freedom
Multiple R-squared:  0.002605,  Adjusted R-squared:  -0.009212 
F-statistic: 0.2205 on 5 and 422 DF,  p-value: 0.9537</code></pre>
</div>
</div>
<p>We then calculate the chi-squared test-statistic by multiplying the number of observations in sample (<em>n</em>) with the R-squared from above regression. Note how we call these two in the R code provided below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate chi-squared test statistic</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sum_stat <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mroz) <span class="sc">*</span> <span class="fu">summary</span>(overid_test)<span class="sc">$</span>r.squared</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sum_stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.115043</code></pre>
</div>
</div>
<p>We can either compare this with a chi-squared table value with 3-1=2 degrees of freedom, or ask R to calculate the corresponding p-value. I find the latter easier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p-value for the calculated test-statistic with 2 degrees of freedom</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(sum_stat, <span class="at">df =</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5726264</code></pre>
</div>
</div>
<p>The p-value is 0.57. There is not enough evidence to reject the null hypothesis that “the instrument set is exogenous”. Hence, overidentifying restrictions are valid.</p>
<p>The results of this task and the previous one confirm that we have a valid set of instruments.</p>
</section>
</section>
<section id="task-11" class="level3" data-number="14.2.5">
<h3 data-number="14.2.5" class="anchored" data-anchor-id="task-11"><span class="header-section-number">14.2.5</span> Task 11</h3>
<p>Test for the existence of endogeneity in the wage regression.</p>
</section>
<section id="guidance-5" class="level3" data-number="14.2.6">
<h3 data-number="14.2.6" class="anchored" data-anchor-id="guidance-5"><span class="header-section-number">14.2.6</span> Guidance</h3>
<p>We will be applying the Durbin-Wu-Hausman test for endogeneity. We will need the saved residuals from the first stage of the 2SLS estimation. Let’s save this under the name <code>resid_2</code> (to differentiate from the single IV case we ran at the beginning)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mroz<span class="sc">$</span>resid_2 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(stage1_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then estimate the original model of interest by additionally including these saved residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>dwh_test <span class="ot">&lt;-</span> <span class="fu">lm</span>(lwage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> expersq <span class="sc">+</span> resid_2,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mroz)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Report the results with robest standard errors</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(dwh_test, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate  Std. Error t value  Pr(&gt;|t|)    
(Intercept) -0.18685736  0.29772776 -0.6276 0.5305971    
educ         0.08039177  0.02136857  3.7621 0.0001922 ***
exper        0.04309732  0.01510368  2.8534 0.0045373 ** 
expersq     -0.00086280  0.00041557 -2.0762 0.0384826 *  
resid_2      0.04718901  0.02630679  1.7938 0.0735598 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="further-reading" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">14.3</span> Further Reading</h2>
<p>See <a href="https://cran.r-project.org/web/packages/ivreg/vignettes/ivreg.html" class="uri">https://cran.r-project.org/web/packages/ivreg/vignettes/ivreg.html</a> for more information and another empirical example.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./panel-data-misspecification.html" class="pagination-link" aria-label="Panel Data Misspecification Tests">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Panel Data Misspecification Tests</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./iv-estimation-institutions-and-growth.html" class="pagination-link" aria-label="IV Estimation: The Role of Institutions in Economic Growth">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">IV Estimation: The Role of Institutions in Economic Growth</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>